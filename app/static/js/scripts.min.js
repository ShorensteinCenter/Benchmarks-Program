const slideLeft=()=>{const e=document.querySelectorAll(".container-fluid"),t=e[0].style.transform,s=null==t?-100:+t.replace(/[^-?\d.]/g,"")-100;for(let t=0;t<e.length;++t)e[t].style.transform="translateX("+s+"vw)"},tagField=(e,t)=>{t?(e.classList.remove("invalid"),e.parentElement.classList.remove("invalid"),e.classList.add("valid"),e.parentElement.classList.add("valid")):(e.classList.remove("valid"),e.parentElement.classList.remove("valid"),e.classList.add("invalid"),e.parentElement.classList.add("invalid"))},clientSideValidate=e=>{const t=e.getAttribute("customType"),s=e.value;let o=!0;return o="key"==t?0!==s.length&&-1!==s.indexOf("-us"):"email"==t?0!==s.length&&-1!==s.indexOf("@")&&-1!==s.indexOf("."):0!==s.length,tagField(e,o),o},clientSlideValidateMultiple=e=>{elts=e.querySelectorAll("input");let t=!0;for(let e=0;e<elts.length;++e)validity=clientSideValidate(elts[e]),validity||(t=!1);return t},formElts=document.querySelectorAll(".form-input-wrapper input");for(let e=0;e<formElts.length;++e){formElts[e].addEventListener("keyup",e=>clientSideValidate(e.currentTarget))}const disableForm=e=>{const t=e.querySelectorAll("input");for(let e=0;e<t.length;++e)t[e].classList.add("disabled")},enableForm=e=>{const t=e.querySelectorAll("input");for(let e=0;e<t.length;++e)t[e].classList.remove("disabled")},csrfToken=document.querySelector("meta[name=csrf-token]").content,checkbox=document.querySelector(".checkbox-container"),agreeToTermsEvt=()=>{slideLeft(),document.querySelector("nav").classList.add("nav-visible")},agreeToTerms=()=>{checkbox.removeEventListener("mousedown",agreeToTerms),setTimeout(agreeToTermsEvt,500)};checkbox.addEventListener("mousedown",agreeToTerms);const basicInfoForm=document.querySelector(".basic-info-form"),submitBasicInfo=async e=>{if(e.preventDefault(),basicInfoForm.removeEventListener("submit",submitBasicInfo),disableForm(basicInfoForm),!clientSlideValidateMultiple(basicInfoForm))return enableForm(basicInfoForm),void basicInfoForm.addEventListener("submit",submitBasicInfo);const t=new Headers({"X-CSRFToken":csrfToken}),s=new FormData(basicInfoForm),o=new Request("/validateBasicInfo",{method:"POST",credentials:"same-origin",headers:t,body:s});try{const e=await fetch(o);if(e.ok)slideLeft();else{if(400!=e.status)throw new Error(e.statusText);{const t=await e.json();for(const[e,s]of Object.entries(t))tagField(document.querySelector("#"+e));enableForm(basicInfoForm),basicInfoForm.addEventListener("submit",submitBasicInfo)}}}catch(e){console.error(e)}};basicInfoForm.addEventListener("submit",submitBasicInfo);const apiForm=document.querySelector(".api-key-form"),submitApiKey=async e=>{if(e.preventDefault(),toggleForm(!0,apiForm,submitApiKey),apiKeyClientSideValidation()){const e=new Headers({"X-CSRFToken":csrfToken}),t=new FormData(apiForm),s=new Request("/validateAPIKey",{method:"POST",credentials:"same-origin",headers:e,body:t});try{const e=await fetch(s);if(!e.ok)throw new Error(e.statusText);showMsg("valid",apiForm),getLists()}catch(e){toggleForm(!1,apiForm,submitApiKey),showMsg("invalid",apiForm),console.error("Failed to fetch:",e)}}else toggleForm(!1,apiForm,submitApiKey),showMsg("invalid",apiForm)},toggleForm=(e,t,s)=>{const o=t.querySelectorAll(".form-submit-wrapper, #submit"),i=t.querySelectorAll(".form-input-wrapper, #key");if(e){t.removeEventListener("submit",s);for(let e=0;e<i.length;++e)i[e].classList.remove("invalid");for(let e=0;e<o.length;++e)o[e].classList.add("inactive")}else{for(let e=0;e<o.length;++e)o[e].classList.remove("inactive");t.addEventListener("submit",s)}},apiKeyClientSideValidation=()=>{const e=apiForm.querySelector("#key").value;return 0!==e.length&&-1!==e.search("-us")},showMsg=(e,t)=>{const s=t.querySelectorAll(".form-input-wrapper, #key");for(let t=0;t<s.length;++t)s[t].classList.add(e)},getLists=async()=>{const e=new Headers({"X-CSRFToken":csrfToken}),t=new Request("/getLists",{method:"GET",credentials:"same-origin",headers:e});try{const e=await fetch(t);if(!e.ok)throw new Error(e.statusText);{const t=await e.json();setupListsTable(t.lists)}}catch(e){console.error("Failed to fetch:",e)}};apiForm.addEventListener("submit",submitApiKey);let listeners=[],listId="",listName="",totalCount=0,openRate=0;const analysisTime=.24,secondsToHm=e=>{if(0==e)return"N/A";e=Number(e);const t=Math.floor(e/3600),s=Math.floor(e%3600/60),o=(t>0?t+(0==s?1==t?" hour":" hours":1==t?" hour, ":" hours, "):"")+(s>0?s+(1==s?" minute":" minutes"):"");return o?"~"+o:"<1 minute"},setupListsTable=e=>{let t="<tbody>";for(let s=0;s<e.length;++s){t+="<tr>",t+="<td>"+e[s].name+"</td>",t+="<td class='d-none d-md-table-cell'>"+e[s].stats.member_count.toLocaleString()+"</td>",t+="<td class='d-none d-md-table-cell'>"+secondsToHm(.24*e[s].stats.member_count)+"</td>",e[s].stats.member_count>0?t+="<td class='analyze-link-column'><a class='analyze-link' list-id='"+e[s].id+"' list-name='"+e[s].name+"' total-count='"+(e[s].stats.member_count+e[s].stats.unsubscribe_count+e[s].stats.cleaned_count)+"' open-rate='"+e[s].stats.open_rate+"' href='#'><div class='analyze-link-text'>Analyze</div><svg class='i-chevron-right' viewBox='0 0 32 32' width='16' height='16' fill='none' stroke='currentcolor' stroke-linecap='round' stroke-linejoin='round' stroke-width='3'><path d='M12 30 L24 16 12 2'></path></svg></a></td>":t+="<td></td>",t+="</tr>"}t+="</tbody>",document.querySelector("thead").insertAdjacentHTML("afterend",t);const s=document.querySelectorAll(".analyze-link");for(let e=0;e<s.length;++e){const t=s[e].getAttribute("list-id"),o=s[e].getAttribute("list-name"),i=s[e].getAttribute("total-count"),a=s[e].getAttribute("open-rate"),n=analyzeList(t,o,i,a);s[e].addEventListener("click",n),listeners[e]=n}slideLeft()},analyzeList=(e,t,s,o)=>i=>{i.preventDefault();const a=document.querySelectorAll(".analyze-link");for(let e=0;e<a.length;++e)a[e].removeEventListener("click",listeners[e]);listId=e,listName=t,totalCount=s,openRate=o,slideLeft()},emailForm=document.querySelector(".email-form"),emailClientSideValidation=()=>{const e=emailForm.querySelector("#key").value;return 0!==e.length&&-1!==e.search("@")&&-1!==e.search(".")},submitEmail=async e=>{if(e.preventDefault(),toggleForm(!0,emailForm,submitEmail),emailClientSideValidation()){let e=new FormData(emailForm);e.append("listId",listId),e.append("listName",listName),e.append("totalCount",totalCount),e.append("openRate",openRate);const t=new Headers({"X-CSRFToken":csrfToken}),s=new Request("/submitEmail",{method:"POST",credentials:"same-origin",headers:t,body:e});try{const e=await fetch(s);if(!e.ok)throw new Error(e.statusText);slideLeft()}catch(e){toggleForm(!1,emailForm,submitEmail),showMsg("invalid",emailForm),console.error("Failed to fetch:",e)}}else toggleForm(!1,emailForm,submitEmail),showMsg("invalid",emailForm)};emailForm.addEventListener("submit",submitEmail);