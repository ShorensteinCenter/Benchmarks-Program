const slideLeft=()=>{const e=document.querySelectorAll(".container-fluid"),t=e[0].style.transform,n=null==t?-100:+t.replace(/[^-?\d.]/g,"")-100;for(let t=0;t<e.length;++t)e[t].style.transform="translateX("+n+"vw)"},tagField=(e,t)=>{t?(e.classList.remove("invalid"),e.parentElement.classList.remove("invalid"),e.classList.add("valid"),e.parentElement.classList.add("valid")):(e.classList.remove("valid"),e.parentElement.classList.remove("valid"),e.classList.add("invalid"),e.parentElement.classList.add("invalid"))},clientSideValidateField=e=>{const t=e.getAttribute("customType"),n=e.value;let s=!0;return s="key"==t?0!==n.length&&-1!==n.indexOf("-us"):"email"==t?0!==n.length&&-1!==n.indexOf("@")&&-1!==n.indexOf("."):0!==n.length,tagField(e,s),s},clientSideValidateForm=e=>{elts=e.querySelectorAll("input");let t=!0;for(let e=0;e<elts.length;++e)validity=clientSideValidateField(elts[e]),validity||(t=!1);return t},formElts=document.querySelectorAll(".form-input-wrapper input");for(let e=0;e<formElts.length;++e){formElts[e].addEventListener("keyup",e=>clientSideValidateField(e.currentTarget))}const disableForm=e=>{for(let t=0;t<e.length;++t)e[t].classList.add("disabled-elt")},enableForm=e=>{for(let t=0;t<e.length;++t)e[t].classList.remove("disabled-elt")},csrfToken=document.querySelector("meta[name=csrf-token]").content,checkbox=document.querySelector(".checkbox-container"),agreeToTerms=()=>{setTimeout(()=>{slideLeft(),document.querySelector("nav").classList.add("nav-visible")},500)};checkbox.addEventListener("mousedown",agreeToTerms,{once:!0});const basicInfoForm=document.querySelector(".basic-info-form"),submitBasicInfo=async e=>{if(e.preventDefault(),basicInfoForm.removeEventListener("submit",submitBasicInfo),disableForm(basicInfoForm.querySelectorAll("input")),!clientSideValidateForm(basicInfoForm))return enableForm(basicInfoForm.querySelectorAll("input")),void basicInfoForm.addEventListener("submit",submitBasicInfo);const t=new Headers({"X-CSRFToken":csrfToken}),n=new FormData(basicInfoForm),s=new Request("/validateBasicInfo",{method:"POST",credentials:"same-origin",headers:t,body:n});try{const e=await fetch(s);if(e.ok)slideLeft();else{if(400!=e.status)throw new Error(e.statusText);{const t=await e.json();for(const[e,n]of Object.entries(t))tagField(document.querySelector("#"+e));enableForm(basicInfoForm.querySelectorAll("input")),basicInfoForm.addEventListener("submit",submitBasicInfo)}}}catch(e){console.error(e)}};basicInfoForm.addEventListener("submit",submitBasicInfo);const apiForm=document.querySelector(".api-key-form"),submitApiKey=async e=>{if(e.preventDefault(),apiForm.removeEventListener("submit",submitApiKey),disableForm(apiForm.querySelectorAll("input")),!clientSideValidateForm(apiForm))return enableForm(apiForm.querySelectorAll("input")),void apiForm.addEventListener("submit",submitApiKey);const t=new Headers({"X-CSRFToken":csrfToken}),n=new FormData(apiForm),s=new Request("/validateAPIKey",{method:"POST",credentials:"same-origin",headers:t,body:n});try{const e=await fetch(s);if(e.ok)keyWrapper=apiForm.querySelector(".form-input-wrapper"),keyWrapper.classList.add("fetching","valid"),getLists();else{if(400!=e.status)throw new Error(e.statusText);{const t=await e.json();for(const[e,n]of Object.entries(t))tagField(document.querySelector("#"+e));enableForm(apiForm.querySelectorAll("input")),apiForm.addEventListener("submit",submitApiKey)}}}catch(e){console.error(e)}},getLists=async()=>{const e=new Headers({"X-CSRFToken":csrfToken}),t=new Request("/getLists",{method:"GET",credentials:"same-origin",headers:e});try{const e=await fetch(t);if(!e.ok)throw new Error(e.statusText);{const t=await e.json();setupListsTable(t.lists)}}catch(e){console.error(e)}};apiForm.addEventListener("submit",submitApiKey);let listeners=[];const analysisTime=.24,secondsToHm=e=>{if(0==e)return"N/A";e=Number(e);const t=Math.floor(e/3600),n=Math.floor(e%3600/60),s=(t>0?t+(0==n?1==t?" hour":" hours":1==t?" hour, ":" hours, "):"")+(n>0?n+(1==n?" minute":" minutes"):"");return s?"~"+s:"<1 minute"},setupListsTable=e=>{let t="<tbody>";for(let n=0;n<e.length;++n){t+="<tr>",t+="<td>"+e[n].name+"</td>",t+="<td class='d-none d-md-table-cell'>"+e[n].stats.member_count.toLocaleString()+"</td>",t+="<td class='d-none d-md-table-cell'>"+secondsToHm(.24*e[n].stats.member_count)+"</td>",e[n].stats.member_count>0?t+="<td class='analyze-link-column'><a class='analyze-link' list-id='"+e[n].id+"' list-name='"+e[n].name+"' total-count='"+(e[n].stats.member_count+e[n].stats.unsubscribe_count+e[n].stats.cleaned_count)+"' open-rate='"+e[n].stats.open_rate+"' href='#'><div class='analyze-link-text'>Analyze</div><svg class='i-chevron-right' viewBox='0 0 32 32' width='16' height='16' fill='none' stroke='currentcolor' stroke-linecap='round' stroke-linejoin='round' stroke-width='3'><path d='M12 30 L24 16 12 2'></path></svg></a></td>":t+="<td></td>",t+="</tr>"}t+="</tbody>",document.querySelector("thead").insertAdjacentHTML("afterend",t);const n=document.querySelectorAll(".analyze-link");for(let e=0;e<n.length;++e){const t=n[e].getAttribute("list-id"),s=n[e].getAttribute("list-name"),r=n[e].getAttribute("total-count"),o=n[e].getAttribute("open-rate"),i=analyzeList(t,s,r,o);n[e].addEventListener("click",i),listeners[e]=i}slideLeft()},analyzeList=(e,t,n,s)=>async r=>{r.preventDefault();const o=document.querySelectorAll(".analyze-link");for(let e=0;e<o.length;++e)o[e].removeEventListener("click",listeners[e]);disableForm(document.querySelectorAll("table"));const i=new Headers({"X-CSRFToken":csrfToken,"content-type":"application/json"}),a={listId:e,listName:t,totalCount:n,openRate:s},l={method:"POST",credentials:"same-origin",headers:i,body:JSON.stringify(a)},c=new Request("/analyzeList",l);try{if(!(await fetch(c)).ok){enableForm(document.querySelectorAll("table"));for(let e=0;e<o.length;++e)o[e].addEventListener("click",listeners[e]);throw new Error(r.statusText)}slideLeft()}catch(r){console.error(r)}};