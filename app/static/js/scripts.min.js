const tagField=(e,t)=>{t?(e.classList.remove("invalid"),e.parentElement.classList.remove("invalid"),e.classList.add("valid"),e.parentElement.classList.add("valid")):(e.classList.remove("valid"),e.parentElement.classList.remove("valid"),e.classList.add("invalid"),e.parentElement.classList.add("invalid"))},clientSideValidateField=e=>{const t=e.getAttribute("customType"),s=e.value;let i=!0;return i="key"==t?0!==s.length&&-1!==s.indexOf("-us"):"email"==t?0!==s.length&&-1!==s.indexOf("@")&&-1!==s.indexOf("."):0!==s.length,tagField(e,i),i},clientSideValidateForm=e=>{const t=e.querySelectorAll("input");let s=!0;for(let e=0;e<t.length;++e){clientSideValidateField(t[e])||(s=!1)}return s},formElts=document.querySelectorAll(".form-input-wrapper input");for(let e=0;e<formElts.length;++e){formElts[e].addEventListener("keyup",e=>clientSideValidateField(e.currentTarget))}const disable=e=>{if(NodeList.prototype.isPrototypeOf(e))for(let t=0;t<e.length;++t)e[t].classList.add("disabled-elt");else e.classList.add("disabled-elt")},enable=e=>{if(NodeList.prototype.isPrototypeOf(e))for(let t=0;t<e.length;++t)e[t].classList.remove("disabled-elt");else e.classList.remove("disabled-elt")},csrfToken=document.querySelector("meta[name=csrf-token]").content,basicInfoForm=document.querySelector("#basic-info-form"),submitBasicInfo=async e=>{if(e.preventDefault(),basicInfoForm.removeEventListener("submit",submitBasicInfo),disable(basicInfoForm.querySelectorAll("input")),!clientSideValidateForm(basicInfoForm))return enable(basicInfoForm.querySelectorAll("input")),void basicInfoForm.addEventListener("submit",submitBasicInfo);const t=new Headers({"X-CSRFToken":csrfToken}),s=new FormData(basicInfoForm),i=new Request("/validate-basic-info",{method:"POST",credentials:"same-origin",headers:t,body:s});try{const e=await fetch(i);if(e.ok)window.location.href="/info-validated";else{if(400!=e.status)throw new Error(e.statusText);{const t=await e.json();for(const[e,s]of Object.entries(t))tagField(document.querySelector("#"+e));enable(basicInfoForm.querySelectorAll("input")),basicInfoForm.addEventListener("submit",submitBasicInfo)}}}catch(e){console.error(e)}};basicInfoForm&&basicInfoForm.addEventListener("submit",submitBasicInfo);const toggles=document.querySelectorAll("span.switch");if(changeActivationStatus=(async e=>{const t=e.currentTarget;t.removeEventListener("change",changeActivationStatus),disable(t);const s=t.getAttribute("switch-id"),i=new Headers({"X-CSRFToken":csrfToken}),n=new Request("/activate-user?user="+s,{method:"GET",credentials:"same-origin",headers:i});try{const s=await fetch(n);if(!s.ok)throw new Error(s.statusText);enable(t),t.addEventListener("change",changeActivationStatus)}catch(e){console.error(e)}}),toggles)for(let e=0;e<toggles.length;++e){toggles[e].addEventListener("change",changeActivationStatus)}