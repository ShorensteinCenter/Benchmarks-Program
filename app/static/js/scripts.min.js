const form=document.querySelector(".api-key-form"),inactiveFields=form.querySelectorAll(".api-key-submit-wrapper, #submit");msgFields=form.querySelectorAll(".api-key-input-wrapper, #key"),csrf_token=document.querySelector("meta[name=csrf-token]").content;const submitApiKey=async e=>{if(e.preventDefault(),toggleForm(!0),clientSideValidation()){const e=new Headers({"X-CSRFToken":csrf_token}),t=new FormData(form),s=new Request("/validateAPIKey",{method:"POST",credentials:"same-origin",headers:e,body:t});try{let e=await fetch(s);if(!e.ok)throw new Error(e.statusText);showMsg("valid"),getLists()}catch(e){toggleForm(!1),showMsg("invalid"),console.log("Failed to fetch:",e)}}else toggleForm(!1),showMsg("invalid")},toggleForm=e=>{if(e){form.removeEventListener("submit",submitApiKey);for(let e=0;e<msgFields.length;++e)msgFields[e].classList.remove("invalid");for(let e=0;e<inactiveFields.length;++e)inactiveFields[e].classList.add("inactive")}else{for(let e=0;e<inactiveFields.length;++e)inactiveFields[e].classList.remove("inactive");form.addEventListener("submit",submitApiKey)}},clientSideValidation=()=>{const e=form.querySelector("#key").value;return 0!==e.length&&-1!==e.search("-us")},showMsg=e=>{for(let t=0;t<msgFields.length;++t)msgFields[t].classList.add(e)},getLists=async()=>{const e=new Headers({"X-CSRFToken":csrf_token}),t=new Request("/getLists",{method:"GET",credentials:"same-origin",headers:e});try{let e=await fetch(t);if(!e.ok)throw new Error(e.statusText);{let t=await e.json();setupListsTable(t.lists)}}catch(e){console.log("Failed to fetch:",e)}},setupListsTable=e=>{let t="<tbody>";for(let s=0;s<e.length;++s)t+="<tr>",t+="<td>"+e[s].name+"</td>",t+="<td>"+e[s].stats.member_count.toLocaleString()+"</td>",t+="<td></td>",t+="<td class='analyze-link-column'><a class='analyze-link' href='#'><div class='analyze-link-text'>Analyze</div><svg class='i-chevron-right' viewBox='0 0 32 32' width='16' height='16' fill='none' stroke='currentcolor' stroke-linecap='round' stroke-linejoin='round' stroke-width='3'><path d='M12 30 L24 16 12 2'></path></svg></a></td>",t+="</tr>";t+="</tbody>",document.querySelector("thead").insertAdjacentHTML("afterend",t);const s=document.querySelectorAll(".container-fluid");for(let e=0;e<s.length;++e)s[e].style.transform="translateX(-100vw)"};form.addEventListener("submit",submitApiKey);